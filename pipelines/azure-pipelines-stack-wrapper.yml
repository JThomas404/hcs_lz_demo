trigger:
  branches:
    include:
      - main
      - develop
  paths:
    include:
      - "live/tenants/tenant-absa-bank/prod/vdcs/vdc-data/rds-primary/**"

variables:
  - group: hcs-credentials

parameters:
  - name: stack_path
    type: string
    default: "live/tenants/tenant-absa-bank/prod/vdcs/vdc-data/rds-primary"
  - name: environment
    type: string
    default: "prod"

stages:
  - stage: Validate
    displayName: "Validate"
    jobs:
      - template: ../templates/stage-validate.yml
        parameters:
          path: ${{ parameters.stack_path }}

  - stage: Plan
    displayName: "Plan"
    dependsOn: Validate
    jobs:
      - template: ../templates/stage-plan.yml
        parameters:
          path: ${{ parameters.stack_path }}

  - stage: Apply
    displayName: "Apply"
    dependsOn: Plan
    jobs:
      - template: ../templates/stage-apply.yml
        parameters:
          environment: ${{ parameters.environment }}
          path: ${{ parameters.stack_path }}

  - stage: Evidence
    displayName: "Evidence"
    dependsOn: Apply
    jobs:
      - template: ../templates/stage-evidence.yml
# Usage
# - Copy this file as a starting point for any stack and update the `trigger.paths` and `stack_path` default.
# - Create an Azure DevOps pipeline pointing to this YAML. It will only trigger for changes under the configured stack path.
